{% for item in product.options_with_values %}
 {% if item.name == 'Color' %}
  {% assign size = item.values | size %}
  {% assign colors = item.values %}
  {% break %}
 {% endif %}
 
{% endfor %}

{% if size >= 1 %} 
  <color-gallery>
   <button class="btn btn--solid btn--small toggle-color-gallery"> 
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
      <path
        fill="#4c3593"
        d="m10,5.51v-1.51c0-1.1-.9-2-2-2h-4c-1.1,0-2,.9-2,2v9.51l1.85-1.85,6.15-6.15Z"
      />
      <path
        fill="#a92451"
        d="m18.16,3c-.78-.78-2.05-.78-2.83,0L6.34,12h11.33l3.34-3.34c.78-.78.78-2.05,0-2.83l-2.84-2.84Z"
      />
      <path
        fill="#f8bc1c"
        d="m6,22h14c1.1,0,2-.9,2-2v-4c0-1.1-.9-2-2-2H6c-2.21,0-4,1.79-4,4s1.79,4,4,4Zm0-5.5c.83,0,1.5.67,1.5,1.5s-.67,1.5-1.5,1.5-1.5-.67-1.5-1.5.67-1.5,1.5-1.5Z"
      />
    </svg>
    <span>
     Ver Galería de colores
    </span>
   </button>
 
  <div id="color-gallery-widget" class="hidden">
   <div class="color-gallery-backdrop">
    <div class="color-gallery-container">
     <div class="color-gallery-header">
      <button class="toggle-color-gallery close-color-gallery">
       {%- render 'icon-cancel' -%}
      </button>
      <h5 class="color-gallery-title">Galería de colores</h5>
      <div class="body-small">
       <p>{{ product.title }} - {{ size }} Colores disponibles.</p>
      </div>
      <hr>
     </div>
     
     <div class="color-gallery-content">
      {% for color in colors %}
       {% for variant in product.variants %}
        {% if variant.title contains color %}
         <div class="color-gallery-item-container">
          <div data-color="{{ color }}" class="color-gallery-item body-small{% if variant.selected or product.selected_or_first_available_variant.title contains color %} color-selected{% endif %}">  
           {% assign url = '' %}
           {% assign url = variant.featured_image | image_url: width: 200 %}
           {% if url != blank %}
            <img src="{{ url }}" alt="{{ color }}" width="200" height="auto" loading="lazy">
            {% else %}
             <span>{{color}}</span> 
            {% endif %}
          </div>
          <div class="body-small">
           <span class="color-gallery-item-title">{{ color }}</span>
          </div>
         </div>
         {% break %}
        {% endif %}        
       {% endfor %}
      {% endfor %}
     </div>
    </div>
   </div>
  </div>
 </color-gallery>
 
 
 <script defer src="{{ 'color-gallery.js' | asset_url }}" defer></script>
 <style>
  .toggle-color-gallery {
   margin-left: .5rem;
   --btn-border: var(--COLOR-QUICK-ADD-BG);
   --btn-border-hover: var(--COLOR-QUICK-ADD-BG-BRIGHTER);
   display: flex;
   align-items: center;
   justify-content: center;
   font-size: var(--BTN-FONT-SIZE);
   color: rgba(0,0, 0, 0.5);
  }
 
  .color-gallery-backdrop {
   position: absolute;
    width: 100%;
    left: 0;
    height: 100vh;
    z-index: 100000;
    background: rgba(0, 0, 0, .10);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.3s ease-in-out;
  }
  .color-gallery-container {
   overflow: scroll;
   background: #ffffff;
   padding: .75rem;
   max-width: 100%;
   height: 100%;
  }
  .color-gallery-content {
   display: grid;
   gap: .25rem;
   grid-template-columns: repeat(2, minmax(130px, 1fr));
  }
  .color-gallery-item {
   display: flex;
   justify-content: center;
   align-items: center;
   cursor: pointer;
   transition: 0.3s ease-in-out;
   overflow: hidden;
   border: 1px solid #00000000;
   margin-bottom: .25rem;
  }
  .color-gallery-item > * {
   transition: 0.3s ease-in-out;
  }
  .color-gallery-item img {
   width: 100%;
   height: 100%;
   object-fit: cover;
   transition: 0.3s ease-in-out;
  }
  .color-gallery-item:hover > img,
  .color-gallery-item:hover > span {
   transform: scale(1.1);
   font-size: 16px;
  }
  .color-gallery-item:hover {
   border: 1px solid #000;
  }
  
  .color-selected {
   border: 1px solid #000;
  }
  .close-color-gallery {
   float: inline-end;
   border: 2px solid #000000;
   width: 24px;
   aspect-ratio: 1;
   padding: 0;
  }

  @media only screen and (min-width: 750px) {
   .toggle-color-gallery {
    margin-left: auto;
    position: relative;
    text-align: center;
    text-decoration: none;
    box-shadow: none;
    cursor: pointer;
   }
   .color-gallery-content {
    display: grid;
    grid-template-columns: repeat(4, minmax(100px, 1fr));
   }
  }
  @media only screen and (min-width: 1280px) {
   .color-gallery-container {
    overflow: inherit;
    padding: 1.5rem;
    max-width: calc(100vw - 80px);
    height: auto;
   }
   .color-gallery-content {
    gap: .75rem;
    grid-template-columns: repeat(5, minmax(200px, 1fr));
   }
  }
 </style>
{% endif %}
